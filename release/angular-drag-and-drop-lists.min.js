var dndList;!function(e){e.directive=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(n){var t=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(e,n,t){t.prototype=e.prototype;var r=new t,i=e.apply(r,n);return"object"==typeof i?i:r}(n,e,function(){return null})};return t.$inject=e,t}}}(dndList||(dndList={})),function(e){var n=function(){function e(e){this.$rootScope=e,this._dragPositionChangedHandlers=[],this._dropHandlers=[]}return Object.defineProperty(e.prototype,"isDragging",{get:function(){return this._isDragging},set:function(e){this._isDragging!==e&&(this._isDragging=e,this.broadcastIsDraggingChanged(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragPosition",{get:function(){return angular.copy(this._dragPosition)},set:function(e){!e||this._dragPosition&&this._dragPosition.x==e.x&&this._dragPosition.y==e.y||(this._dragPosition=angular.copy(e),this.broadcastDragPositionChanged())},enumerable:!0,configurable:!0}),e.prototype.subscribeIsDraggingChanged=function(n,t){n.$on(e._DndService_IsDraggingChanged_,function(e,n){t(n)})},e.prototype.subscribeDragPositionChanged=function(e,n){var t=this;this._dragPositionChangedHandlers.push(n),e.$on("$destroy",function(){t._dragPositionChangedHandlers.splice(t._dragPositionChangedHandlers.indexOf(n),1)})},e.prototype.subscribeDrop=function(e,n){var t=this;this._dropHandlers.push(n),e.$on("$destroy",function(){t._dropHandlers.splice(t._dropHandlers.indexOf(n),1)})},e.prototype.drop=function(){return __awaiter(this,void 0,void 0,function(){var e,n,t,r;return __generator(this,function(i){switch(i.label){case 0:e=angular.copy(this._dragPosition),n=0,i.label=1;case 1:return n<this._dropHandlers.length?(t=this._dropHandlers[n],void 0===(r=t(e)).success?[3,2]:r.success?(this.isDragging=!1,[2,r]):[3,4]):[3,5];case 2:return[4,r];case 3:if(i.sent().success)return this.isDragging=!1,[2,r];i.label=4;case 4:return n++,[3,1];case 5:return this.isDragging=!1,[2,{success:!1}]}})})},e.prototype.broadcastDragPositionChanged=function(){for(var e=angular.copy(this._dragPosition),n=0,t=this._dragPositionChangedHandlers;n<t.length;n++){(0,t[n])(e)}},e.prototype.broadcastIsDraggingChanged=function(n){this.$rootScope.$broadcast(e._DndService_IsDraggingChanged_,n)},e._DndService_IsDraggingChanged_="_DndService_IsDraggingChanged_",e.$inject=["$rootScope"],e}();angular.module("dndLists",[]).service("dndService",n)}(dndList||(dndList={})),function(e){var n=function(){function n(e,n,t,r){var i=this;this.$parse=e,this.$timeout=n,this.dndService=t,this.$window=r,this.link=function(e,n,t){return __awaiter(i,void 0,void 0,function(){var r,i,o,d,a,s,c,l,g,u,p=this;return __generator(this,function(f){return r=this,o=function(r){p.performDrag(e,n,r,t)},d=function(r){i?a(r):(r.preventDefault(),i=!0,angular.element(window).off("mouseup",a),angular.element(window).on("mouseup",a),setTimeout(function(){i&&!e.dragging&&(p.dragStart(e,n,r,t),angular.element(window).off("mousemove",o),angular.element(window).on("mousemove",o))},200))},a=function(r){i=!1,angular.element(window).off("mouseup",a),e.dragging&&(p.dragEnd(e,n,r,t),angular.element(window).off("mousemove",o))},s=function(){e.dragging&&p.dragEnd(e,n,{clientX:p.dndService.dragPosition.x,clientY:p.dndService.dragPosition.y},t),angular.element(window).off("mouseup",a),angular.element(window).off("mousemove",o),g&&angular.element(g).off("mousedown",d)},c=function(e,t){if(void 0===t&&(t=!0),"string"!=typeof e)t&&(g=e),angular.element(e).off("mousedown",d),angular.element(e).on("mousedown",d);else{e=n[0].querySelectorAll(e),t&&(g=e);for(var r=0;r<e.length;r++)c(e[r],!1)}},t.ngDisabled&&(e.disabled=e.$eval(t.ngDisabled),e.$watch(t.ngDisabled,function(n,t){return __awaiter(p,void 0,void 0,function(){return __generator(this,function(t){return e.disabled=n,n?s():c(g),[2]})})})),l=function(n){e.disabled||t.dndSelected&&(e.$apply(function(){r.$parse(t.dndSelected)(e,{event:n})}),n.stopPropagation())},function(){n.off("click touchstart",l),n.on("click touchstart",l)}(),t.dndHandle?(u=e.$eval(t.dndHandle),c(u),e.$watch(t.dndHandle,function(e,n,t){s(),c(e)})):c(n[0]),e.$on("$destroy",function(){return s()}),[2]})})}}return n.prototype.dragEnd=function(e,n,t,r){return __awaiter(this,void 0,void 0,function(){var i,o=this;return __generator(this,function(d){switch(d.label){case 0:return e.dragging?(this.performDrag(e,n,t,r),e.dragging=!1,this.dndService.draggingElement.parentNode.removeChild(this.dndService.draggingElement),n.removeClass("dndDragging"),[4,this.dndService.drop()]):[2];case 1:return i=d.sent(),this.$timeout(function(){if(n[0].style.display="block",angular.element(document.body).removeClass("dndDraggingBody"),!i.success)return o.$parse(r.dndCanceled)(e,{event:t}),void(i.callback&&i.callback(!1));o.$parse(r.dndMoved)(e,{event:t})?(o.$parse(r.dndDragend)(e,{event:t,isDroped:!0}),i.callback&&i.callback(!0)):i.callback&&i.callback(!0)},0),[2]}})})},n.prototype.dragStart=function(e,n,t,r){var i=this;if(!e.disabled&&!e.dragging){e.dragging=!0,angular.element(document.body).addClass("dndDraggingBody");var o=n[0],d=o.getBoundingClientRect(),a=d.left-t.clientX,s=d.top-t.clientY;e.mouseStartPosition={x:a,y:s};var c=0,l=0,g=n[0].cloneNode(!0),u=angular.element(g);u.addClass("dndDragging"),u.css("width",d.width+"px"),u.css("height",d.height+"px");var p=g.style.display;g.style.display="none",document.body.appendChild(u[0]),d=g.getBoundingClientRect(),c+=t.clientX-d.left+a,l+=t.clientY-d.top+s,e.transform={x:c,y:l},g.style.webkitTransform=g.style.transform="translate("+c+"px, "+l+"px)",this.dndService.draggingObject=e.$eval(r.dndDraggable),this.dndService.draggingElementScope=e,this.dndService.draggingElement=g,this.dndService.draggingSourceElement=n[0],this.dndService.isDragging=!0,g.style.display=p,this.$timeout(function(){i.$parse(r.dndDragstart)(e,{event:t}),i.performDrag(e,n,t,r),o.style.display="none"},0)}},n.prototype.performDrag=function(e,n,t,r){if(!e.disabled&&e.dragging){var i=this.dndService.draggingElement,o=i.getBoundingClientRect();e.transform.x+=t.clientX-o.left+e.mouseStartPosition.x,e.transform.y+=t.clientY-o.top+e.mouseStartPosition.y,t.clientX>=0&&t.clientX<this.$window.outerWidth&&t.clientY>=0&&t.clientY<this.$window.outerHeight&&(i.style.webkitTransform=i.style.transform="translate("+e.transform.x+"px, "+e.transform.y+"px)",this.dndService.dragPosition={x:t.clientX,y:t.clientY})}},n=__decorate([e.directive("$parse","$timeout","dndService","$window")],n)}();angular.module("dndLists").directive("dndDraggable",n)}(dndList||(dndList={})),function(e){var n=function(){function n(e,n,t,r){var i=this;this.$parse=e,this.$timeout=n,this.dndService=t,this.$q=r,this.link=function(e,n,t){var r=i.getPlaceholderElement(n);r.remove();e.placeholder=r,e.element=n;t.dndAccept&&t.dndAccept;i.dndService.subscribeDragPositionChanged(e,function(r){var o;o=r,i.dragging(e,n[0],o,t)}),i.dndService.subscribeIsDraggingChanged(e,function(n){n||i.stopDrag(e)}),i.dndService.subscribeDrop(e,function(n){return i.tryDrop(e,n,t)}),t.ngDisabled&&(e.disabled=e.$eval(t.ngDisabled),e.$watch(t.ngDisabled,function(n,t){e.disabled=n,n||i.stopDrag(e)}))}}return n.prototype.isMouseInFirstHalf=function(e,n,t){void 0===t&&(t=!1);var r=t?e.x:e.y,i=n.getBoundingClientRect(),o=t?i.width:i.height;return r<(t?i.left:i.top)+o/2},n.prototype.checkInRange=function(e,n,t){var r=n.getBoundingClientRect();return!(t.x>r.right||t.x<r.left||t.y>r.bottom||t.y<r.top||!this.dndService.isDragging||e.disabled)},n.prototype.dragging=function(e,n,t,r){this.checkInRange(e,n,t)?e.isDraggingOver?this.performDrag(e,n,t,r):this.startDrag(e,n,t,r):this.stopDrag(e)},n.prototype.stopDrag=function(e){e.isDraggingOver&&(e.isDraggingOver=!1,e.placeholder.remove(),e.element.removeClass("dndDragover"))},n.prototype.startDrag=function(e,n,t,r){if(!e.disabled&&this.dndService.isDragging){var i=angular.element(this.dndService.draggingElement),o=i.css("display");i.css("display","none");var d=document.elementFromPoint(t.x,t.y);if(i.css("display",o),d&&d!==n){for(var a=d;a.parentNode!==n&&a.parentNode;)a=a.parentNode;a&&a.parentNode==n&&(e.isDraggingOver=!0,this.performDrag(e,n,t,r))}}},n.prototype.performDrag=function(e,n,t,r){if(!e.disabled&&this.dndService.isDragging){var i=angular.element(this.dndService.draggingElement),o=e.placeholder[0],d=e.element[0];if(r.dndDragover&&r.dndDragover&&!this.invokeCallback(e,r.dndDragover,t,this.getPlaceholderIndex(d,o),this.dndService.draggingObject))this.stopDrag(e);else{var a;o.parentNode!=d&&n.parentNode.appendChild(o);var s=i.css("display");if(i.css("display","none"),a=document.elementFromPoint(t.x,t.y),i.css("display",s),a&&a!==d){for(var c=a;c.parentNode!==d&&c.parentNode;)c=c.parentNode;c.parentNode===d&&c!==o&&(this.isMouseInFirstHalf(t,c)?d.insertBefore(o,c):d.insertBefore(o,c.nextElementSibling))}e.element.addClass("dndDragover")}}},n.prototype.tryDrop=function(e,n,t){var r=this;if(!this.checkInRange(e,e.element[0],n))return{success:!1};if(!e.isDraggingOver)return{success:!1};var i=this.dndService.draggingObject;if(!i)return{success:!0};i=angular.copy(i);var o=e.placeholder[0],d=e.element[0];return new Promise(function(a,s){r.$timeout(function(){var s=r.getPlaceholderIndex(d,o);if(s<0)return r.stopDrag(e),void a({success:!1});if(t.dndDragover&&!r.invokeCallback(e,t.dndDragover,n,s,i))return r.stopDrag(e),void a({success:!1});if(t.dndBeforeDrop&&!r.invokeCallback(e,t.dndBeforeDrop,n,s,i))return r.stopDrag(e),void a({success:!1});s=r.getPlaceholderIndexWithoutNode(d,o,r.dndService.draggingSourceElement),a({success:!0,callback:function(o){r.stopDrag(e),o&&(t.dndDrop&&(i=r.invokeCallback(e,t.dndDrop,n,s,i)),!0!==i&&e.$eval(t.dndList).splice(s,0,i),r.invokeCallback(e,t.dndInserted,n,s,i))}})},0)})},n.prototype.getPlaceholderIndex=function(e,n){return Array.prototype.indexOf.call(e.children,n)},n.prototype.getPlaceholderIndexWithoutNode=function(e,n,t){for(var r=0,i=0;i<e.children.length;i++,r++){if(e.children[i]==n)return r;e.children[i]==t&&r--}return r},n.prototype.invokeCallback=function(e,n,t,r,i){return void 0===i&&(i=null),this.$parse(n)(e,{position:t,index:r,item:i||void 0})},n.prototype.getPlaceholderElement=function(e){var n;return angular.forEach(e.children(),function(e){var t=angular.element(e);t.hasClass("dndPlaceholder")&&(n=t)}),n||angular.element("<li class='dndPlaceholder'></li>")},n=__decorate([e.directive("$parse","$timeout","dndService","$q")],n)}();angular.module("dndLists").directive("dndList",n)}(dndList||(dndList={})),function(e){var n=function(){function n(e,n){var t=this;this.$timeout=e,this.dndService=n,this.scope={dndScroll:"="},this.link=function(e,n,r){e.dndScroll.speed||(e.dndScroll.speed=6),e.dndScroll.offset||(e.dndScroll.offset=20),e.dndScroll.offsetOuter||(e.dndScroll.offsetOuter=0);t.dndService.subscribeDragPositionChanged(e,function(r){var i;i=r,t.dragging(e,n[0],i.x,i.y)}),t.dndService.subscribeIsDraggingChanged(e,function(n){n||t.stopScroll(e)})}}return n.prototype.isInRange=function(e,n,t,r){var i=e.dndScroll.offset,o=e.dndScroll.offsetOuter,d=n.getBoundingClientRect();return!(t>d.right||t<d.left)&&(r>=d.bottom-i&&r<=d.bottom+o||r<=d.top+i&&r>=d.top-o)},n.prototype.dragging=function(e,n,t,r){var i=e.dndScroll.offset,o=e.dndScroll.offsetOuter,d=n.getBoundingClientRect();t>d.right||t<d.left?this.stopScroll(e):r>=d.bottom-i&&r<=d.bottom+o?this.startScroll(e,n,1):r<=d.top+i&&r>=d.top-o?this.startScroll(e,n,-1):this.stopScroll(e)},n.prototype.startScroll=function(e,n,t){this.stopScroll(e),this.performScroll(e,n,t)},n.prototype.performScroll=function(e,n,t){var r=this;if(this.dndService.isDragging&&this.isInRange(e,n,this.dndService.dragPosition.x,this.dndService.dragPosition.y)){var i=0;1==t?(i=e.dndScroll.speed,n.scrollTop+i+n.offsetHeight>n.scrollHeight&&(i=n.scrollHeight-n.scrollTop-n.offsetHeight),i<0&&(i=0)):-1==t&&(i=-e.dndScroll.speed,n.scrollTop+i<0&&(i=-n.scrollTop)),n.scrollTop+=i,e.timer=setTimeout(function(){r.performScroll(e,n,t)},20)}},n.prototype.stopScroll=function(e){e.timer&&(clearTimeout(e.timer),e.timer=null)},n=__decorate([e.directive("$timeout","dndService")],n)}();angular.module("dndLists").directive("dndScroll",n)}(dndList||(dndList={})),function(e){e.IsIE=function(){return!!/MSIE 10/i.test(navigator.userAgent)||!(!/MSIE 9/i.test(navigator.userAgent)&&!/rv:11.0/i.test(navigator.userAgent))}}(dndList||(dndList={}));